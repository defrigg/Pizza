<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Pizza | POS + ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô + ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</title>
<style>
  :root{
    --bg:#0f1115; --panel:#171a21; --soft:#202534; --soft-2:#2a3142;
    --text:#e8ecf1; --muted:#a9b3c1; --accent:#36d399; --danger:#ff6b6b; --warn:#fbbf24;
    --border:#2b3244;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,TH Sarabun New,Prompt,sans-serif;
    color:var(--text); background:linear-gradient(180deg,#0f1115,#0f1115 40%,#121624 100%);
  }
  header{
    position:sticky; top:0; z-index:10; backdrop-filter: blur(6px);
    background:rgba(15,17,21,.7); border-bottom:1px solid var(--border);
  }
  .wrap{max-width:1200px; margin:0 auto; padding:16px}
  .brand{display:flex; align-items:center; gap:12px;}
  .logo{
    width:44px; height:44px; border-radius:12px; background:conic-gradient(from 200deg at 50% 50%, #ff9f1c, #ff4040, #ff9f1c);
    display:grid; place-items:center; font-weight:900; color:#111; border:2px solid #0007;
    box-shadow:0 6px 20px #ff404033, inset 0 0 30px #fff2;
  }
  .brand h1{margin:0; font-size:22px; letter-spacing:.5px}
  .price-strip{display:flex; gap:12px; color:var(--muted); font-size:14px; flex-wrap:wrap}
  .pill{background:var(--soft); padding:6px 10px; border-radius:999px; border:1px solid var(--border)}
  .nav{display:flex; gap:6px; flex-wrap:wrap}
  .tab{background:var(--soft); border:1px solid var(--border); padding:8px 12px; border-radius:999px; cursor:pointer}
  .tab.active{background:#1f2a44; border-color:#3a425c; color:#cfe2ff}

  main{display:grid; grid-template-columns:1.3fr .7fr; gap:16px; padding:16px}
  @media (max-width: 900px){ main{grid-template-columns:1fr} }
  .panel{background:var(--panel); border:1px solid var(--border); border-radius:16px}
  .panel h2{margin:0; padding:16px; border-bottom:1px solid var(--border); font-size:18px}

  /* Menu grid */
  .menu{display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:12px; padding:16px}
  .card{
    background:var(--soft); border:1px solid var(--border); border-radius:14px; padding:14px; display:flex; flex-direction:column; gap:10px;
    transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
  }
  .card:hover{transform:translateY(-2px); box-shadow:0 8px 30px #0006; border-color:#3a425c}
  .card h3{margin:0 0 6px 0; font-size:16px}
  .desc{color:var(--muted); font-size:13px; line-height:1.35; min-height:3.6em}
  .actions{display:flex; gap:8px; margin-top:auto}
  button{
    cursor:pointer; border:none; border-radius:10px; padding:10px 12px; background:var(--soft-2); color:var(--text);
    border:1px solid var(--border); font-weight:600
  }
  button:hover{filter:brightness(1.05)}
  .btn-add-piece{background:#23304a}
  .btn-add-tray{background:#1f3a2f}
  .btn-danger{background:#3a2227; border-color:#5a2b33; color:#ffdfe3}
  .btn-accent{background:#103a2c; border-color:#185a44; color:#b6ffe4}
  .btn-warn{background:#3b341f; border-color:#5d4c17; color:#ffe9b0}

  /* Cart */
  .cart-wrap{padding:0}
  .cart-body{padding:12px 16px}
  .cart-tools{display:flex; gap:8px; padding:12px 16px; border-top:1px dashed var(--border); flex-wrap:wrap}
  table{width:100%; border-collapse:collapse}
  th, td{padding:10px 8px; border-bottom:1px solid var(--border); text-align:left; font-size:14px}
  th{color:var(--muted); font-weight:600}
  td.qty{white-space:nowrap}
  .qty-ctrl{display:inline-flex; border:1px solid var(--border); border-radius:999px; overflow:hidden}
  .qty-ctrl button{padding:6px 10px}
  .num{display:inline-block; min-width:22px; text-align:center}
  .right{text-align:right}
  .muted{color:var(--muted)}
  .summary{padding:12px 16px; border-top:1px solid var(--border); display:grid; gap:6px}
  .summary .row{display:flex; justify-content:space-between; font-size:15px}
  .summary .total{font-size:20px; font-weight:800}
  .flex{display:flex; gap:8px; align-items:center}
  input[type="number"], input[type="text"], select{
    background:#11141b; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 12px; width:100%
  }

  /* Views */
  .view{display:none}
  .view.active{display:block}

  /* Daily & History */
  .grid{display:grid; gap:12px; padding:16px}
  .stats{display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px}
  .stat{background:var(--soft); border:1px solid var(--border); border-radius:14px; padding:12px}
  .stat h3{margin:0 0 8px 0; font-size:14px; color:var(--muted)}
  .stat .val{font-size:22px; font-weight:800}
  .filter-row{display:flex; gap:8px; flex-wrap:wrap; align-items:center}

  /* Receipt print */
  @media print{
    header, .menu, .cart-tools, .nav, .view:not(.pos){display:none !important}
    main{grid-template-columns:1fr !important}
    .panel{border:none}
    body{background:#fff; color:#000}
    .summary .total{font-size:18px}
    .print-only{display:block !important}
  }
  .print-only{display:none}
  .saving{color:var(--accent); font-weight:700}
  .warn-txt{color:var(--warn)}
  .badge{font-size:12px; padding:2px 8px; border-radius:999px; background:#253149; border:1px solid #3a425c; color:#cfe2ff}
</style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <div class="brand">
        <div class="logo">üçï</div>
        <div>
          <h1>The Pizza</h1>
          <div class="price-strip">
            <span class="pill">‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ <b>25</b> ‡∏ö‡∏≤‡∏ó</span>
            <span class="pill">‡∏ñ‡∏≤‡∏î‡∏•‡∏∞ <b>189</b> ‡∏ö‡∏≤‡∏ó</span>
            <span class="pill">1 ‡∏ñ‡∏≤‡∏î = <b>8</b> ‡∏ä‡∏¥‡πâ‡∏ô</span>
          </div>
        </div>
      </div>
      <nav class="nav">
        <button class="tab active" data-view="pos">‡∏Ç‡∏≤‡∏¢ (POS)</button>
        <button class="tab" data-view="daily">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
        <button class="tab" data-view="history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</button>
      </nav>
    </div>
  </header>

  <!-- POS VIEW -->
  <section class="view pos active">
    <main class="wrap">
      <!-- Menu -->
      <section class="panel">
        <h2>‡πÄ‡∏°‡∏ô‡∏π‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤</h2>
        <div class="menu" id="menuGrid"></div>
      </section>

      <!-- Cart / POS -->
      <section class="panel cart-wrap">
        <h2>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
        <div class="cart-body">
          <table id="cartTable">
            <thead>
              <tr>
                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                <th class="right">‡∏ä‡∏ô‡∏¥‡∏î</th>
                <th class="right">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                <th class="right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <th class="right">‡∏£‡∏ß‡∏°</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="cartBody">
              <tr id="emptyRow"><td colspan="6" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</td></tr>
            </tbody>
          </table>
        </div>

        <div class="cart-tools">
          <button class="btn-warn" id="optimizeBtn">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏à‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ñ‡∏≤‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</button>
          <button class="btn-danger" id="clearBtn">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
          <span class="badge">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏π‡∏Å‡∏™‡∏∏‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á ‚Äú‡∏ä‡∏¥‡πâ‡∏ô‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏ñ‡∏≤‡∏î‚Äù ‡∏ï‡πà‡∏≠‡∏£‡∏™</span>
        </div>

        <div class="summary">
          <div class="row"><span>‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏±‡∏ö</span><span class="right" id="rawSubtotal">0</span></div>
          <div class="row"><span>‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î (‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏ñ‡∏≤‡∏î)</span><span class="right saving" id="saving">0</span></div>
          <div class="row total"><span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span class="right" id="grandTotal">0</span></div>

          <div class="row" style="gap:8px; align-items:center">
            <span>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</span>
            <span style="min-width:200px">
              <select id="payMethod">
                <option value="cash">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
                <option value="transfer">‡πÇ‡∏≠‡∏ô/QR</option>
                <option value="card">‡∏ö‡∏±‡∏ï‡∏£</option>
              </select>
            </span>
            <span style="min-width:180px"><input id="cashInput" type="number" min="0" step="1" placeholder="‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (‡∏ö‡∏≤‡∏ó)"></span>
            <span>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô</span><span class="right" id="change">0</span>
          </div>

          <div class="flex" style="margin-top:8px; flex-wrap:wrap">
            <button class="btn-accent" id="checkoutBtn">‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô & ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>
            <button id="downloadBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (.json)</button>
            <input id="customerName" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" />
          </div>
          <div class="muted" style="font-size:12px">* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î ‚Äú‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô‚Äù ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
        </div>

        <!-- Receipt (print view) -->
        <div class="print-only" id="printArea">
          <h2 style="margin:8px 0 0 0">The Pizza ‚Äî ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h2>
          <div id="receiptMeta" style="font-size:13px; color:#444"></div>
          <table style="margin-top:8px">
            <thead>
              <tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="right">‡∏ä‡∏ô‡∏¥‡∏î</th><th class="right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th class="right">‡∏£‡∏≤‡∏Ñ‡∏≤</th></tr>
            </thead>
            <tbody id="receiptBody"></tbody>
          </table>
          <div style="margin-top:8px; display:grid; gap:4px; max-width:360px; margin-left:auto">
            <div style="display:flex; justify-content:space-between"><span>‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏±‡∏ö</span><b id="rRaw">0</b></div>
            <div style="display:flex; justify-content:space-between"><span>‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î</span><b id="rSave">0</b></div>
            <div style="display:flex; justify-content:space-between; font-size:18px"><span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><b id="rTotal">0</b></div>
            <div style="display:flex; justify-content:space-between"><span>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</span><b id="rPayMethod">-</b></div>
            <div style="display:flex; justify-content:space-between"><span>‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</span><b id="rCash">0</b></div>
            <div style="display:flex; justify-content:space-between"><span>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô</span><b id="rChange">0</b></div>
          </div>
          <p style="margin-top:12px;font-size:12px;color:#444">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô üçï</p>
        </div>
      </section>
    </main>
  </section>

  <!-- DAILY VIEW -->
  <section class="view daily">
    <div class="wrap panel">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ ‚Äú‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‚Äù</h2>
      <div class="grid">
        <div class="stats">
          <div class="stat"><h3>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</h3><div class="val" id="dSum">0</div></div>
          <div class="stat"><h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•</h3><div class="val" id="dOrders">0</div></div>
          <div class="stat"><h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</h3><div class="val" id="dSlices">0</div></div>
          <div class="stat"><h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</h3><div class="val" id="dTrays">0</div></div>
          <div class="stat"><h3>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ö‡∏¥‡∏•</h3><div class="val" id="dAvg">0</div></div>
          <div class="stat"><h3>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞ (‡∏™‡∏î/‡πÇ‡∏≠‡∏ô/‡∏ö‡∏±‡∏ï‡∏£)</h3><div class="val" id="dPayMix">-</div></div>
        </div>

        <div>
          <h3 style="margin:0 0 8px 0">10 ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
          <table id="dLastTable">
            <thead><tr><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th><th>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div>
          <h3 style="margin:0 0 8px 0">‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ (Top 5)</h3>
          <table id="dTopTable">
            <thead><tr><th>‡πÄ‡∏°‡∏ô‡∏π</th><th class="right">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ä‡∏¥‡πâ‡∏ô + ‡∏ñ‡∏≤‡∏î*8)</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- HISTORY VIEW -->
  <section class="view history">
    <div class="wrap panel">
      <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</h2>
      <div class="grid">
        <div class="filter-row">
          <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: </label>
          <select id="monthPicker"></select>
          <button id="exportCSV">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</button>
          <button class="btn-danger" id="wipeData">‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <span class="muted">* ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á/‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ (localStorage)</span>
        </div>

        <div class="stats">
          <div class="stat"><h3>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3><div class="val" id="mSum">0</div></div>
          <div class="stat"><h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3><div class="val" id="mOrders">0</div></div>
          <div class="stat"><h3>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ö‡∏¥‡∏• ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h3><div class="val" id="mAvg">0</div></div>
        </div>

        <div>
          <h3 style="margin:0 0 8px 0">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h3>
          <table id="mByDay">
            <thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th class="right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•</th><th class="right">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

<script>
/** ---------- CONFIG ---------- */
const PRICE_PER_SLICE = 25;
const PRICE_PER_TRAY  = 189;
const SLICES_PER_TRAY = 8;

const MENU = [
  { id: 'haw',  name: '‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏Æ‡∏≤‡∏ß‡∏≤‡πÄ‡∏≠‡∏µ‡πâ‡∏¢', desc: '‡πÅ‡∏õ‡πâ‡∏á‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏õ‡∏π‡∏≠‡∏±‡∏î‡πÅ‡∏Æ‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏õ‡∏£‡∏î‡πÄ‡∏™‡∏£‡∏¥‡∏ü‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ä‡∏µ‡∏™‡πÄ‡∏¢‡∏¥‡πâ‡∏°‡πÜ' },
  { id: 'spin', name: '‡∏ú‡∏±‡∏Å‡πÇ‡∏Ç‡∏°‡πÅ‡∏Æ‡∏°‡∏ä‡∏µ‡∏™',   desc: '‡πÅ‡∏õ‡πâ‡∏á‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡∏ú‡∏±‡∏Å‡πÇ‡∏Ç‡∏°‡∏Ñ‡∏±‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏Æ‡∏°‡∏´‡∏≠‡∏°‡πÜ ‡∏ä‡∏µ‡∏™‡∏¢‡∏∑‡∏î‡πÜ' },
  { id: 'bac',  name: '‡πÄ‡∏ö‡∏Ñ‡πà‡∏≠‡∏ô‡∏ä‡∏µ‡∏™',       desc: '‡πÅ‡∏õ‡πâ‡∏á‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡πÄ‡∏≠‡∏≤‡πÉ‡∏à‡∏™‡∏≤‡∏¢‡πÄ‡∏ö‡∏Ñ‡πà‡∏≠‡∏ô‡∏´‡∏≠‡∏°‡πÜ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏µ‡∏™‡∏¢‡∏∑‡∏î‡πÜ' },
  { id: 'saus', name: '‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏µ‡∏™',      desc: '‡πÅ‡∏õ‡πâ‡∏á‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏µ‡∏™‡∏¢‡∏∑‡∏î‡πÜ' },
  { id: 'ham',  name: '‡πÅ‡∏Æ‡∏°‡∏ä‡∏µ‡∏™',          desc: '‡πÅ‡∏õ‡πâ‡∏á‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡πÅ‡∏Æ‡∏°‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ä‡∏µ‡∏™‡πÄ‡∏¢‡∏¥‡πâ‡∏°‡πÜ' },
  { id: 'corn', name: '‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î‡∏ä‡∏µ‡∏™',      desc: '‡πÅ‡∏õ‡πâ‡∏á‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î‡∏Ñ‡∏±‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏ä‡∏µ‡∏™‡∏¢‡∏∑‡∏î‡πÜ' },
  { id: 'sea',  name: '‡∏ã‡∏µ‡∏ü‡∏π‡πâ‡∏î',          desc: '‡πÅ‡∏õ‡πâ‡∏á‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡∏¢‡∏Å‡∏ó‡∏∞‡πÄ‡∏•‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏∏‡πâ‡∏á ‡∏´‡∏≠‡∏¢ ‡∏´‡∏°‡∏∂‡∏Å ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏µ‡∏™‡πÄ‡∏¢‡∏¥‡πâ‡∏°‡πÜ' },
];

/** ---------- STORAGE ---------- */
const LS_KEY = 'thepizza_orders_v1';
const loadOrders = () => JSON.parse(localStorage.getItem(LS_KEY) || '[]');
const saveOrders = (arr) => localStorage.setItem(LS_KEY, JSON.stringify(arr));

/** ---------- STATE ---------- */
let cart = []; // {id, name, type:'slice'|'tray', qty, unit, subtotal}

/** ---------- HELPERS ---------- */
const money = n => (Math.round(n)).toLocaleString('th-TH');
const ymd = d => {
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
};
const ym = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
const parseISO = s => new Date(s);

function addItem(id, type){
  const menu = MENU.find(m => m.id===id);
  const unit = type==='slice' ? PRICE_PER_SLICE : PRICE_PER_TRAY;
  const key = cart.findIndex(it => it.id===id && it.type===type);
  if(key>-1){ cart[key].qty++; cart[key].subtotal = cart[key].qty * cart[key].unit; }
  else{ cart.push({ id, name:menu.name, type, qty:1, unit, subtotal:unit }); }
  renderCart();
}

function inc(i){ cart[i].qty++; cart[i].subtotal = cart[i].qty*cart[i].unit; renderCart(); }
function dec(i){
  cart[i].qty--; if(cart[i].qty<=0){ cart.splice(i,1); }
  else{ cart[i].subtotal = cart[i].qty*cart[i].unit; }
  renderCart();
}
function removeRow(i){ cart.splice(i,1); renderCart(); }

function clearCart(){
  if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){ cart = []; renderCart(); }
}

/** Best price per flavor: group slices into trays where cheaper */
function optimize(){
  const byFlavor = {};
  cart.forEach(it=>{
    if(!byFlavor[it.id]) byFlavor[it.id] = { name: it.name, slices:0, trays:0 };
    if(it.type==='slice') byFlavor[it.id].slices += it.qty;
    else byFlavor[it.id].trays += it.qty;
  });

  let newCart = [];
  for(const [id, v] of Object.entries(byFlavor)){
    const totalSlices = v.slices + v.trays*SLICES_PER_TRAY;
    let best = { trays:0, slices:totalSlices, cost: totalSlices*PRICE_PER_SLICE };
    const maxTrays = Math.floor(totalSlices / SLICES_PER_TRAY);
    for(let t=0;t<=maxTrays;t++){
      const s = totalSlices - t*SLICES_PER_TRAY;
      const cost = t*PRICE_PER_TRAY + s*PRICE_PER_SLICE;
      if(cost < best.cost) best = { trays:t, slices:s, cost };
    }
    if(best.trays>0){
      newCart.push({ id, name:v.name, type:'tray', qty:best.trays, unit:PRICE_PER_TRAY, subtotal:best.trays*PRICE_PER_TRAY });
    }
    if(best.slices>0){
      newCart.push({ id, name:v.name, type:'slice', qty:best.slices, unit:PRICE_PER_SLICE, subtotal:best.slices*PRICE_PER_SLICE });
    }
  }
  cart = newCart;
  renderCart(true);
}

function totals(){
  // show saving = (if sold as slice only) - best composition
  const byFlavor = {};
  cart.forEach(it=>{
    if(!byFlavor[it.id]) byFlavor[it.id]={ slices:0, trays:0 };
    if(it.type==='slice') byFlavor[it.id].slices += it.qty;
    else byFlavor[it.id].trays += it.qty;
  });
  let bestPrice = 0, sliceOnly = 0;
  for(const f of Object.values(byFlavor)){
    const totalSlices = f.slices + f.trays*SLICES_PER_TRAY;
    bestPrice += f.trays*PRICE_PER_TRAY + f.slices*PRICE_PER_SLICE;
    sliceOnly += totalSlices * PRICE_PER_SLICE;
  }
  const saving = Math.max(0, sliceOnly - bestPrice);
  return { rawSubtotal: sliceOnly, saving, grand: bestPrice };
}

function renderMenu(){
  const g = document.getElementById('menuGrid');
  g.innerHTML = MENU.map(m => `
    <article class="card">
      <h3>${m.name}</h3>
      <p class="desc">${m.desc}</p>
      <div class="actions">
        <button class="btn-add-piece" onclick="addItem('${m.id}','slice')">+ ‡∏ä‡∏¥‡πâ‡∏ô (‡∏ø${PRICE_PER_SLICE})</button>
        <button class="btn-add-tray"  onclick="addItem('${m.id}','tray')">+ ‡∏ñ‡∏≤‡∏î (‡∏ø${PRICE_PER_TRAY})</button>
      </div>
    </article>
  `).join('');
}

function renderCart(skipAutoEmpty){
  const body = document.getElementById('cartBody');
  body.innerHTML = '';
  if(cart.length===0){
    body.innerHTML = `<tr id="emptyRow"><td colspan="6" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</td></tr>`;
  }else{
    cart.forEach((it,i)=>{
      body.insertAdjacentHTML('beforeend', `
        <tr>
          <td>${it.name}</td>
          <td class="right">${it.type==='slice'?'‡∏ä‡∏¥‡πâ‡∏ô':'‡∏ñ‡∏≤‡∏î'}</td>
          <td class="right">‡∏ø${money(it.unit)}</td>
          <td class="right qty">
            <span class="qty-ctrl">
              <button onclick="dec(${i})">‚àí</button>
              <span class="num">${it.qty}</span>
              <button onclick="inc(${i})">+</button>
            </span>
          </td>
          <td class="right">‡∏ø${money(it.subtotal)}</td>
          <td class="right"><button class="btn-danger" onclick="removeRow(${i})">‡∏•‡∏ö</button></td>
        </tr>
      `);
    });
  }
  const t = totals();
  document.getElementById('rawSubtotal').textContent = '‡∏ø' + money(t.rawSubtotal);
  document.getElementById('saving').textContent = '‡∏ø' + money(t.saving);
  document.getElementById('grandTotal').textContent = '‡∏ø' + money(t.grand);

  const method = document.getElementById('payMethod').value;
  const cash = parseFloat(document.getElementById('cashInput').value||0);
  const change = method==='cash' ? Math.max(0, cash - t.grand) : 0;
  document.getElementById('change').textContent = '‡∏ø' + money(change);
}

function buildReceipt(method, cash, change){
  const now = new Date();
  const meta = [
    `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${now.toLocaleDateString('th-TH',{year:'numeric',month:'long',day:'numeric'})}`,
    `‡πÄ‡∏ß‡∏•‡∏≤: ${now.toLocaleTimeString('th-TH')}`,
    `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${document.getElementById('customerName').value || '-'}`
  ].join(' | ');
  document.getElementById('receiptMeta').textContent = meta;

  const rBody = document.getElementById('receiptBody');
  rBody.innerHTML = '';
  let merged = {};
  cart.forEach(it=>{
    const k = it.id+'-'+it.type;
    if(!merged[k]) merged[k]={ name:it.name, type:it.type, qty:0, subtotal:0 };
    merged[k].qty += it.qty;
    merged[k].subtotal += it.subtotal;
  });
  Object.values(merged).forEach(it=>{
    rBody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${it.name}</td>
        <td class="right">${it.type==='slice'?'‡∏ä‡∏¥‡πâ‡∏ô':'‡∏ñ‡∏≤‡∏î'}</td>
        <td class="right">${it.qty}</td>
        <td class="right">‡∏ø${money(it.subtotal)}</td>
      </tr>
    `);
  });

  const t = totals();
  document.getElementById('rRaw').textContent   = '‡∏ø' + money(t.rawSubtotal);
  document.getElementById('rSave').textContent  = '‡∏ø' + money(t.saving);
  document.getElementById('rTotal').textContent = '‡∏ø' + money(t.grand);
  document.getElementById('rPayMethod').textContent = method==='cash'?'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î':(method==='transfer'?'‡πÇ‡∏≠‡∏ô/QR':'‡∏ö‡∏±‡∏ï‡∏£');

  document.getElementById('rCash').textContent   = '‡∏ø' + money(cash);
  document.getElementById('rChange').textContent = '‡∏ø' + money(change);
}

function downloadJSON(){
  const data = buildOrderPayload(); // uses current cart totals, etc.
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `order-${Date.now()}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function buildOrderPayload(){
  const t = totals();
  const method = document.getElementById('payMethod').value;
  const cash = parseFloat(document.getElementById('cashInput').value||0);
  const change = method==='cash' ? Math.max(0, cash - t.grand) : 0;
  // Flatten cart items for storage
  const items = cart.map(c => ({ id:c.id, name:c.name, type:c.type, qty:c.qty, unit:c.unit, subtotal:c.subtotal }));
  // Count pieces/trays for stats
  let totalSlices=0, totalTrays=0;
  items.forEach(i=>{
    if(i.type==='slice') totalSlices += i.qty;
    else totalTrays += i.qty;
  });

  return {
    id: 'O' + Date.now(),
    ts: new Date().toISOString(),
    customer: document.getElementById('customerName').value || null,
    items,
    counts: { slices: totalSlices, trays: totalTrays },
    totals: { raw: t.rawSubtotal, saving: t.saving, grand: t.grand },
    payment: { method, cash: method==='cash'?cash:0, change }
  };
}

/** ---------- CHECKOUT (PAY) ---------- */
function checkout(){
  if(cart.length===0){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤'); return; }
  optimize(); // ensure best price
  const t = totals();
  const method = document.getElementById('payMethod').value;
  const cash = parseFloat(document.getElementById('cashInput').value||0);
  if(method==='cash' && cash < t.grand){
    alert('‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏ä‡∏≥‡∏£‡∏∞ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥');
    return;
  }
  const change = method==='cash' ? Math.max(0, cash - t.grand) : 0;

  // Build receipt UI and print
  buildReceipt(method, cash, change);
  window.print();

  // Save order to history
  const orders = loadOrders();
  orders.push(buildOrderPayload());
  saveOrders(orders);

  // Reset cart for next order
  cart = [];
  document.getElementById('cashInput').value = '';
  document.getElementById('customerName').value = '';
  renderCart();

  // Refresh analytics views (if user‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤)
  renderDaily();
  populateMonths();
  renderMonthView();
}

/** ---------- DAILY SUMMARY ---------- */
function renderDaily(){
  const today = ymd(new Date());
  const orders = loadOrders().filter(o => ymd(parseISO(o.ts)) === today);

  const sum = orders.reduce((s,o)=> s + (o.totals?.grand||0), 0);
  const count = orders.length;
  const avg = count? (sum / count) : 0;

  let slices=0, trays=0;
  let payCount = { cash:0, transfer:0, card:0 };
  let menuCounter = {}; // count total slices-equivalent per menu
  orders.forEach(o=>{
    slices += o.counts?.slices||0;
    trays  += o.counts?.trays||0;
    if(o.payment?.method) payCount[o.payment.method]++;
    (o.items||[]).forEach(it=>{
      const eq = it.type==='tray' ? it.qty*SLICES_PER_TRAY : it.qty;
      menuCounter[it.name] = (menuCounter[it.name]||0) + eq;
    });
  });

  document.getElementById('dSum').textContent    = '‡∏ø' + money(sum);
  document.getElementById('dOrders').textContent = money(count);
  document.getElementById('dSlices').textContent = money(slices);
  document.getElementById('dTrays').textContent  = money(trays);
  document.getElementById('dAvg').textContent    = '‡∏ø' + money(avg);

  const mix = `‡∏™‡∏î ${payCount.cash||0} | ‡πÇ‡∏≠‡∏ô ${payCount.transfer||0} | ‡∏ö‡∏±‡∏ï‡∏£ ${payCount.card||0}`;
  document.getElementById('dPayMix').textContent = mix;

  // last 10 orders
  const tbody = document.querySelector('#dLastTable tbody');
  tbody.innerHTML = '';
  orders.slice(-10).reverse().forEach(o=>{
    const t = new Date(o.ts);
    tbody.insertAdjacentHTML('beforeend',
      `<tr><td>${t.toLocaleTimeString('th-TH')}</td><td class="right">‡∏ø${money(o.totals.grand)}</td><td>${o.payment.method==='cash'?'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î':(o.payment.method==='transfer'?'‡πÇ‡∏≠‡∏ô/QR':'‡∏ö‡∏±‡∏ï‡∏£')}</td></tr>`);
  });

  // top menus
  const top = Object.entries(menuCounter).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const tBody = document.querySelector('#dTopTable tbody');
  tBody.innerHTML = '';
  top.forEach(([name,eq])=>{
    tBody.insertAdjacentHTML('beforeend', `<tr><td>${name}</td><td class="right">${money(eq)}</td></tr>`);
  });
}

/** ---------- MONTHLY HISTORY ---------- */
function getAllMonths(){
  const orders = loadOrders();
  const set = new Set(orders.map(o=> {
    const d = parseISO(o.ts); return ym(d);
  }));
  // Always include current month
  set.add(ym(new Date()));
  return Array.from(set).sort().reverse(); // latest first
}

function populateMonths(){
  const sel = document.getElementById('monthPicker');
  const months = getAllMonths();
  const current = ym(new Date());
  sel.innerHTML = months.map(m => `<option value="${m}" ${m===current?'selected':''}>${m}</option>`).join('');
}

function renderMonthView(){
  const sel = document.getElementById('monthPicker');
  const [yy,mm] = sel.value.split('-').map(x=>parseInt(x,10));
  const orders = loadOrders().filter(o=>{
    const d = parseISO(o.ts);
    return d.getFullYear()===yy && (d.getMonth()+1)===mm;
  });

  const sum = orders.reduce((s,o)=> s + (o.totals?.grand||0), 0);
  const count = orders.length;
  const avg = count? (sum / count) : 0;

  document.getElementById('mSum').textContent    = '‡∏ø' + money(sum);
  document.getElementById('mOrders').textContent = money(count);
  document.getElementById('mAvg').textContent    = '‡∏ø' + money(avg);

  // By day
  const byDay = {};
  orders.forEach(o=>{
    const d = ymd(parseISO(o.ts));
    byDay[d] = (byDay[d]||0) + (o.totals?.grand||0);
  });
  // Also count orders per day
  const byDayCount = {};
  orders.forEach(o=>{
    const d = ymd(parseISO(o.ts));
    byDayCount[d] = (byDayCount[d]||0) + 1;
  });

  const tbody = document.querySelector('#mByDay tbody');
  tbody.innerHTML = '';
  Object.keys(byDay).sort().forEach(d=>{
    tbody.insertAdjacentHTML('beforeend',
      `<tr><td>${d}</td><td class="right">${money(byDayCount[d])}</td><td class="right">‡∏ø${money(byDay[d])}</td></tr>`);
  });
}

/** ---------- CSV EXPORT & DATA RESET ---------- */
function exportMonthCSV(){
  const month = document.getElementById('monthPicker').value;
  const [yy,mm] = month.split('-').map(x=>parseInt(x,10));
  const orders = loadOrders().filter(o=>{
    const d = parseISO(o.ts);
    return d.getFullYear()===yy && (d.getMonth()+1)===mm;
  });

  let lines = ['id,datetime,customer,payment,grand,saving,raw,slices,trays'];
  orders.forEach(o=>{
    const line = [
      o.id,
      o.ts,
      (o.customer||''),
      o.payment?.method||'',
      o.totals?.grand||0,
      o.totals?.saving||0,
      o.totals?.raw||0,
      o.counts?.slices||0,
      o.counts?.trays||0
    ].map(v => (String(v).includes(',')? `"${String(v).replace(/"/g,'""')}"` : v));
    lines.push(line.join(','));
  });

  const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `thepizza-${month}.csv`;
  a.click();
  URL.revokeObjectURL(url);
}

function wipeAllData(){
  if(confirm('‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')){ localStorage.removeItem(LS_KEY); renderDaily(); populateMonths(); renderMonthView(); }
}

/** ---------- NAV ---------- */
function switchView(view){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelector('.view.'+view).classList.add('active');
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelector(`.tab[data-view="${view}"]`).classList.add('active');

  if(view==='daily') renderDaily();
  if(view==='history'){ populateMonths(); renderMonthView(); }
}

/** ---------- INIT ---------- */
renderMenu();
renderCart();

// POS events
document.getElementById('optimizeBtn').addEventListener('click', optimize);
document.getElementById('clearBtn').addEventListener('click', clearCart);
document.getElementById('cashInput').addEventListener('input', ()=>renderCart(true));
document.getElementById('payMethod').addEventListener('change', ()=>{
  const pm = document.getElementById('payMethod').value;
  document.getElementById('cashInput').disabled = (pm!=='cash');
  renderCart(true);
});
document.getElementById('downloadBtn').addEventListener('click', downloadJSON);
document.getElementById('checkoutBtn').addEventListener('click', checkout);

// NAV events
document.querySelectorAll('.tab').forEach(b=> b.addEventListener('click', ()=> switchView(b.dataset.view)));

// History events
document.getElementById('exportCSV').addEventListener('click', exportMonthCSV);
document.getElementById('wipeData').addEventListener('click', wipeAllData);
document.getElementById('monthPicker').addEventListener('change', renderMonthView);

// defaults
document.getElementById('cashInput').disabled = false;
</script>
</body>
</html>
